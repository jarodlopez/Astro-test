---
import Layout from '../layouts/Layout.astro';
import ProductCard from '../components/ProductCard.jsx';
import CartSidebar from '../components/CartSidebar.jsx';
import { db } from '../lib/firebase';
import { collection, getDocs, query, where } from 'firebase/firestore';

// Obtener productos desde el servidor (Build time o SSR)
const APP_ID = 'pos-pro-mobile-v2';
let products = [];

try {
  const q = query(collection(db, 'artifacts', APP_ID, 'public', 'data', 'products'), where("active", "==", true));
  const snapshot = await getDocs(q);
  products = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
} catch (e) {
  console.error("Error cargando productos:", e);
}
---

<Layout title="CactusWorld | HomeMart Shop">
  <CartSidebar client:load />

  <section class="relative h-[60vh] flex items-center justify-center overflow-hidden">
    <div class="absolute inset-0 bg-stone-900">
       <img src="/hero-cactus.jpg" class="w-full h-full object-cover opacity-60" />
    </div>
    <div class="relative z-10 text-center text-white p-4">
      <h1 class="text-5xl font-bold mb-4">Naturaleza en tu Hogar</h1>
      <p class="text-xl text-stone-200 mb-8">Plantas y decoraci칩n con gesti칩n en tiempo real.</p>
      <a href="#shop" class="bg-emerald-600 px-8 py-3 rounded-full font-bold hover:bg-emerald-500 transition">Ver Cat치logo</a>
    </div>
  </section>

  <section id="shop" class="container mx-auto px-6 py-20">
    <div class="text-center mb-12">
      <h2 class="text-3xl font-bold text-stone-800">Nuestra Colecci칩n</h2>
      <p class="text-stone-500">Sincronizado con inventario en vivo</p>
    </div>

    {products.length === 0 ? (
      <p class="text-center text-red-500">No se pudieron cargar los productos o no hay stock.</p>
    ) : (
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
        {products.map(p => (
          <ProductCard client:visible product={p} />
        ))}
      </div>
    )}
  </section>
</Layout>

